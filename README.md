# planeta_10m
## Новая плата управления системой информации "Планета 10М"

Новая плата управления основана на родных микросхемах КР580ВВ55А, которые управляются микроконтроллером Atmega16. Так же в схеме стоит микрокомпьютер Omega2, который может прошивать Atmega16 и заливать по UART матрицу состояний светодиодов (управление тем что выводиться в общем).

### Необходимые настройки  
Для начала необходимо расширить дисковое пространстро Omega2. Либо подключив USB накопитель, либо используя SD карту. Инструкцию можно найти [тут](https://docs.onion.io/omega2-docs/boot-from-external-storage.html) (*проверено 26.05.2020*)  
На Omega2 необходимо установить avrdude и python3 следующими командами  
*opkg update*
  *opkg install avrdude python3 python3-pip*  
*pip3 install pyserial*



Далее скопировать прошивку *Planeta.hex* и файл конфигурации *avrdude.conf* в директорию Omega2 */root*  
После этого необходимо прошить встроенный микроконтроллер Atmega16. 
Проверяем подключение
   *avrdude -p atmega16 -C /root/avrdude.conf -c planeta -v*  
Если все нормально, то прошиваем  
*avrdude -p atmega16 -C /etc/avrdude.conf -c planeta -v -U flash:w:Planeta.hex:i*



Теперь необходимо скопировать *start.py* в директорию /root и добавить его загрузку в cron
    *crontab -e*
   после чего вписать следующую строчку  

*`*` `*` `*` `*` `*` ps | grep "python3 /root/start.py" | grep -v grep || python3 /root/start.py*



Остается только перезагрузить Omega2
  *reboot*  

### Настройка строки
Для изменения выводимой информации необходимо поменять строку в файле *start.py*  
### Принцип работы  
Микроконтроллер принимает байт по UART интерфейсу, после чего сдвигает весь свой буфер столбцов на еденицу и в младший разряд добавляет принятый байт.  
![Фотография новой платы управления](https://pp.userapi.com/c850332/v850332604/12ac78/CXK2vB_eXcY.jpg "Новые мозги!")

Ролик по созданию этой платы [здесь](https://классная_ссылка.рф)

Схема и проект печатки лежит [здесь](https://easyeda.com/naym1993/planeta-10m)

Подписывайтесь на группу [Radionews](https://vk.com/bestradionews)
